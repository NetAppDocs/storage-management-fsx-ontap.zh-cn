---
sidebar: sidebar 
permalink: use/task-replicate-data.html 
keywords: amazon fsx for netapp ontap, fsx, manage fsx for ontap system, delete fsx for ontap system, remove fsx for ontap system, throughput capacity, change throughput, automatic capacity management, capacity management, storage capacity, replication, classification, sync, backup, recovery, bluexp, NetApp Console 
summary: 在NetApp Console中创建或发现 FSx for ONTAP系统后，您可以管理文件系统并使用提供备份和恢复等功能的NetApp数据服务。 
---
= 在 NetApp Console 中将数据复制到 FSx for ONTAP
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
复制数据以防止数据丢失，如果数据所在的区域发生灾难。FSx for ONTAP 文件系统与本地 ONTAP 系统或 Cloud Volumes ONTAP 之间支持数据复制。

对于存储 VM 迁移，必须在创建复制关系后立即完成切换操作。



== 关于此任务

复制可保护您的数据免受区域灾难的影响，并支持 Storage VM 迁移。

目标文件系统中的复制卷是数据保护 (DP) 卷，并遵循以下命名格式： `{OriginalVolumeName}_copy`。

如果使用不可变文件复制源卷，则目标卷和文件系统将保持锁定状态，直到源卷的保留期结束。当您 link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-volume.html["创建卷"] FSx for ONTAP 文件系统时，不可变文件功能可用。

[NOTE]
====
* 使用 iSCSI 或 NVMe 协议的块卷不支持复制。
* 您可以复制一个源（读/写）卷或一个数据保护（DP）卷。支持级联复制，但不支持第三个跃点。详细了解 link:https://review.docs.netapp.com/us-en/workload-fsx-ontap_cascade-replication/cascade-replication.html["级联复制"^]。


====


=== 迁移使用案例

选择迁移用例时，可以选择复制单个存储 VM 的存储 VM 数据和配置设置。在同时迁移数据和配置设置时，请确保该卷的最后一次复制在过去 24 小时内完成。必须选择同一存储 VM 中的所有卷才能使用此功能。所有卷的分层策略默认为源卷的分层策略，建议用于迁移用例。

Workload Factory 支持以下存储系统之间的迁移复制。

* 本地 ONTAP 系统和适用于 ONTAP 的 FSx 文件系统
* Cloud Volumes ONTAP 和 FSx for ONTAP 文件系统
* 适用于 ONTAP 和适用于 ONTAP 文件系统的 FSx
+
** 第一代到第一代
** 第一代到第二代
** 第二代到第二代




要迁移存储 VM 数据和配置设置，必须完成两个操作。

. <<创建复制关系,创建复制关系>>，选择 *Migration* 作为用例，然后选择 *Replicate storage VM configuration*。
. <<切换复制以用于迁移用例,切换复制以用于迁移用例>> 将数据和配置设置从源文件系统永久迁移到目标 FSx for ONTAP 文件系统。


要使用此功能，请创建



== 创建复制关系

在两个 FSx for ONTAP 文件系统之间、本地 ONTAP 系统和 FSx for ONTAP 文件系统之间，或者 Cloud Volumes ONTAP 和 FSx for ONTAP 文件系统之间复制数据。

.开始之前
在开始之前，请查看这些要求。

* 要在 FSx for ONTAP 和本地 ONTAP 或 Cloud Volumes ONTAP 之间复制数据，必须将链接关联到文件系统。link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["了解如何关联现有链接或创建和关联新链接"]。关联链接后，返回此操作。
* 对于从本地 ONTAP 系统复制到 FSx for ONTAP 文件系统，请确保您已发现本地 ONTAP 系统。
* 不支持对处于可用、已创建或配置错误以外的状态以及 ONTAP 版本不兼容的卷执行复制。
* 对于迁移用例，请确保在使用存储 VM 数据和配置设置创建复制关系之前，卷的最后一次复制在过去 24 小时内完成。


.步骤
. 从 NetApp Console 系统页面，将源 FSx for ONTAP 文件系统、本地 ONTAP 系统或 Cloud Volumes ONTAP 系统拖到目标 FSx for ONTAP 文件系统之上，然后选择*复制*。
. 在“创建复制”页面上，选择要复制的源卷，然后单击“下一步”。
. 在复制目标下，提供以下内容：
+
.. *目标名称*：在 Console Systems 页面中将源存储系统拖放到目标系统上时应用了目标名称。
.. *用例*：选择以下其中一个用例进行复制。根据所选的用例，Workload Factory 会根据最佳实践在表单中填写推荐值。您可以接受建议的值，也可以在填写表格时进行更改。
+
*** 迁移：将您的数据传输到目标 FSx for ONTAP文件系统
+
*复制存储 VM 配置*：可选择复制单个存储 VM 的存储 VM 数据和配置设置。在同时迁移数据和配置设置时，请确保该卷的最后一次复制在过去 24 小时内完成。必须选择同一存储 VM 中的所有卷才能使用此功能。所有卷的分层策略默认为源卷的分层策略，建议用于迁移用例。

*** 热灾难恢复：确保关键工作负载的高可用性和快速灾难恢复
*** 冷灾难恢复或存档灾难恢复：
+
**** 冷灾难恢复：使用更长的恢复时间目标（RTO）和恢复点对象（RPO）来降低成本
**** 存档：复制数据以实现长期存储和合规性


*** 其他
+
此外，用例选择决定了复制策略或SnapMirror策略（ONTAP）。用于描述复制策略的术语来自link:https://docs.netapp.com/us-en/ontap/data-protection/default-protection-policies-concept.html["ONTAP 9 文档"^]。

+
**** 对于迁移和其他，复制策略称为_MirrorAllSnapshots_。  _MirrorAllSnapshots_ 是一种异步策略，用于镜像所有快照和最新的活动文件系统。
**** 对于热、冷或存档灾难恢复，复制策略称为_MirrorAndVault_。  _MirrorAndVault_ 是一种异步和保险库策略，用于镜像最新的活动文件系统以及每日和每周快照。
+
对于所有用例，如果您启用快照进行长期保留，则默认复制策略为_MirrorAndVault_。





.. *FSx for ONTAP 文件系统*：为目标 FSx for ONTAP 文件系统选择凭据、区域和 FSx for ONTAP 文件系统名称。
.. *存储虚拟机名称*：从下拉菜单中选择存储虚拟机。您选择的存储虚拟机是此复制关系中所有选定卷的目标。
.. *卷名称*：目标卷名称自动生成，格式如下 `{OriginalVolumeName}_copy`。您可以使用自动生成的卷名或输入其他卷名。
.. *分层策略*：选择目标卷中存储的数据的分层策略。分层策略默认为您选择的用例的推荐分层策略。
+
使用 Workload Factory 控制台创建卷时，_平衡（自动）_ 是默认分层策略。有关卷分层策略的更多信息，请参阅link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/volume-storage-capacity.html#data-tiering-policy["卷存储容量"^]在 AWS FSx for NetApp ONTAP文档中。请注意，工作负载工厂在工作负载工厂控制台中使用基于用例的名称来制定分层策略，并在括号中包含 FSx for ONTAP分层策略名称。

+
如果您选择了迁移用例，Workload Factory 会自动选择将源卷的分层策略复制到目标卷。您可以取消选择复制分层策略并选择适用于选择进行复制的卷的分层策略。

.. *最大传输速率*：选择*限制*并输入最大传输限制（MB/s）。或者，选择*无限制*。
+
如果没有限制，网络和应用程序性能可能会下降。或者，我们建议对于关键工作负载（例如主要用于灾难恢复的工作负载）使用 FSx for ONTAP文件系统的无限制传输速率。



. 在复制设置下，提供以下内容：
+
.. *复制间隔*：选择快照从源卷传输到目标卷的频率。
.. *长期保留*：可选地，启用快照以进行长期保留。长期保留使业务服务即使在整个站点发生故障时也能继续运行，支持应用程序使用辅助副本透明地进行故障转移。
+
没有长期保留的复制使用_MirrorAllSnapshots_策略。启用长期保留会将 _MirrorAndVault_ 策略分配给复制。

+
如果启用长期保留，则选择现有策略或创建新策略来定义要复制的快照和要保留的数量。

+

NOTE: 长期保留需要匹配的源标签和目标标签。如果需要，工作负载工厂可以为您创建缺失的标签。

+
*** *选择现有策略*：从下拉菜单中选择一个现有策略。
*** *创建新策略*：输入*策略名称*。


.. *不可变快照*：可选。选择“启用不可变快照”以防止在保留期内删除此策略中拍摄的快照。
+
*** 以小时、天、月或年为单位设置*保留期*。
*** *快照策略*：在表格中，选择快照策略频率和要保留的副本数。您可以选择多个快照策略。


.. *S3 access point*：可选择连接 S3 access point，通过 AWS S3 API 访问驻留在 NFS 或 SMB/CIFS 卷上的 FSx for ONTAP 文件系统数据。仅支持文件访问类型。提供以下详细信息：
+
*** *S3 接入点名称*：输入 S3 接入点的名称。
*** *User*：选择有权访问卷的现有用户或创建新用户。
*** *用户类型*：选择 *UNIX* 或 *Windows* 作为用户类型。
*** *网络配置*：选择 *Internet* 或 *Virtual private cloud (VPC)*。您选择的网络类型决定了接入点是可从互联网访问还是仅限于特定的 VPC。
*** *启用元数据*：启用元数据会创建一个 S3 表，其中包含 S3 访问点可访问的所有对象，可用于审计、治理、自动、分析和优化。启用元数据会产生额外的 AWS 成本。有关详细信息，请参见 link:https://aws.amazon.com/s3/pricing/["Amazon S3 定价文档"^]。


.. *S3 接入点标签*：您最多可以添加 50 个标签（可选）。




. 选择“*创建*”。


.结果
复制关系显示在目标 FSx for ONTAP 文件系统的*复制关系*选项卡中。

如果您创建了用于迁移的复制关系，则必须切换所有卷及其关联的存储 VM，以完成将存储 VM 数据和配置设置迁移到目标 FSx for ONTAP 文件系统。



== 切换复制以用于迁移用例

为迁移用例创建复制关系后，必须切换复制以完成将存储 VM 数据和配置设置迁移到目标 FSx for ONTAP 文件系统。切换复制会将数据和存储 VM 配置设置从源文件系统永久迁移到目标 FSx for ONTAP 文件系统。在切换期间，数据会进行最后一次复制。切换完成后，系统会删除源卷。您无法撤消此操作。

.开始之前
在开始之前，请查看这些要求。

* 在切换复制之前，请停止对 Storage VM 的任何客户端访问。
* 在切换复制之前，请确保所有源卷均未提供任何数据。
* 在切换复制之前，请确保数据在源卷和目标卷之间同步。
* 用于复制关系的 FSx for ONTAP 文件系统必须具有相关联的链接。link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["了解如何关联现有链接或创建和关联新链接"]。关联链接后，返回此操作。


.步骤
. 在 NetApp Console 中，选择菜单 image:workloads-menu-icon.png["汉堡菜单图标用于导航到存储、EDA、AI、数据库、VMware 和管理等工作负载。"]，然后选择*存储*。
. 在存储菜单中，选择 *FSx for ONTAP*。
. 从 *FSx for ONTAP* 中，选择包含要复制的卷的文件系统。
. 选择 *Replication relationships* 选项卡。
. 在复制关系表中，选择要切换的复制关系，然后选择 *Cut over replication* 。
. 查看"切换复制"对话框中的信息，然后键入 _cut over_ 确认。


. 选择 *Cut over*。


.结果
切换后，源卷将被删除，目标卷变为读/写。切换后，您可以link:https://docs.netapp.com/us-en/workload-fsx-ontap/change-tiering-policy.html["修改分层策略"]目标卷。
